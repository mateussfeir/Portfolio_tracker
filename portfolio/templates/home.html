<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> <!-- Plotly JS -->
</head>
{% load humanize %}
<body>
    <h1>Welcome, {{ username }}!</h1>

    <!-- Bitcoin Price -->
    <h2>The current Bitcoin price is:
        {% if bitcoin_price %}
            ${{ bitcoin_price|floatformat:2|intcomma }}
        {% else %}
            Could not fetch the price. Please try again later.
        {% endif %}
    </h2>

    <!-- User's Crypto Positions -->
    <h2>Your Crypto Positions:</h2>
    {% if assets %}
    <table border="1">
        <thead>
            <tr>
                <th>Ticker</th>
                <th>Amount</th>
                <th>Value (USD)</th>
                <th>Allocation (%)</th>
            </tr>
        </thead>
        <tbody>
            {% for asset in assets %}
            <tr>
                <td>{{ asset.ticker }}</td>
                <td>{{ asset.amount }}</td>
                <td>
                    {% if asset.value %}
                        ${{ asset.value|floatformat:2|intcomma }}
                    {% else %}
                        Could not fetch price
                    {% endif %}
                </td>
                <td>
                    {% if asset.percentage %}
                        {{ asset.percentage|floatformat:2 }}%
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <h3>Total Net Worth: ${{ total_net_worth|floatformat:2|intcomma }}</h3>
    {% else %}
    <p>You have no crypto positions yet.</p>
    {% endif %}

    <!-- Add a New Position -->
    <h2>Add a New Position</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Add Position</button>
    </form>

    <!-- Pie Chart -->
    <h2>Your Portfolio Distribution</h2>
    <div>
        {{ chart|safe }}
    </div>

    <a href="{% url 'logout' %}">Logout</a>
</body>
</html>